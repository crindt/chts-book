---
title: "6.2 Data Request for Del Norte County"
author: "Suman Mitra"
date: "08/28/2015"
output: html_document
---

## Data Request for Del Norte County

1. Trips by Mode
2. Modal split for driving alone
3. Trip distance by Mode
4. Trip duration by Mode
5. Trips by Purpose
6. Work trips by mode

## Summary and Methodology

We generate tables by mode for the following: total number of trips, total trip distance, average trip distance, total trip duration, average trip duration, and total number of trips for driving alone.  To calculate the drive alone numbers we extract data for total travelers (`TOTTR=1`) and `MODE={5, 6, 7, 8, 10}` (basically, drivers of cars, trucks, or motorcycles). We also generate tables for the total number of trips by trip purpose and for work trips by mode. Here, we actually generate tables for total number of trips by activity purpose since the trip purpose is given in the database as activity purpose and there is more than one activity in many single trips. We consider each activity as a trip. We only consider the purpose code (`APURP=9`) for work trips.  We generate every table for both trips originating in and ending in Del Norte County. We use the new county wide weights of the Del Norte County to generate weighted results for trips that originated in Del Norte County and statewide weights to generate weighted results for trips that originated outside of Del Norte County. 


## R Code and Implementation

The following commands are used to generate the results.

### Trips to Del Norte County

#### Mode split calculations

To answer the questions we need the place level table (with weights) that we computed in the section 4.

```{r dnc-1, cache=TRUE}
rd <- "/home/crindt/chts-book"
p <- function(ps) { return(paste(rd,ps,sep="/")) }

# Set the working directory
setwd(p("District 1/DelNorte County"))


#Import the place level with new weight csv file and give a new name
nplace<- read.csv(p("Weight/NewWeightData/nplacedata3032015.csv"), header=TRUE)
names(nplace)
head(nplace)# Show first ten observations

# make sure CTFIP is an integer
nplace$CTFIP <- as.integer(nplace$CTFIP) %% 1000

```

Next, we do some manipulations to determine origin county and convert the `MODE` codes into 
text descriptions.

```{r dnc-2,cache=TRUE}
# Create trip origin county 
# Need dplyr
library("dplyr")
nplacedata <- nplace %>% group_by(SAMPN,PERNO)%>% arrange(SAMPN,PERNO,PLANO) %>% mutate(OCTFIP=lag(CTFIP))

# For recoding Mode
nplacedata$Mode<-ifelse(nplacedata$MODE==1,"Walk",ifelse(nplacedata$MODE==2,"Bike",ifelse(nplacedata$MODE==3,"Wheelchair/Mobility Scooter",ifelse(nplacedata$MODE==4,"Other Non-Motorized",ifelse(nplacedata$MODE==5,"Auto/Van/Truck Driver",ifelse(nplacedata$MODE==6,"Auto /Van/Truck Passenger",ifelse(nplacedata$MODE==7,"Carpool/Vanpool",ifelse(nplacedata$MODE==8,"Motorcycle/Scooter/Moped",ifelse(nplacedata$MODE==9,"Taxi/Hired Car/Limo",ifelse(nplacedata$MODE==10,"Rental Car/Vehicle",ifelse(nplacedata$MODE==11,"Private shuttle ",ifelse(nplacedata$MODE==12,"Greyhound Bus",ifelse(nplacedata$MODE==13,"Plane",ifelse(nplacedata$MODE==14,"Other Private Transit",ifelse(nplacedata$MODE==15,"Local Bus,Rapid Bus",ifelse(nplacedata$MODE==16,"Express Bus/Commuter Bus",ifelse(nplacedata$MODE==17,"Premium Bus",ifelse(nplacedata$MODE==18,"School Bus",ifelse(nplacedata$MODE==19,"Public Transit Shuttle",ifelse(nplacedata$MODE==20,"Air BART/LAX Fly Away",ifelse(nplacedata$MODE==21,"Dial-a-Ride/Paratransit", ifelse(nplacedata$MODE==22,"Amtrak Bus", ifelse(nplacedata$MODE==23,"Other Bus ", ifelse(nplacedata$MODE==24,"BART,Metro Red/Purple Line",ifelse(nplacedata$MODE==25,"ACE, Amtrak, Cal train",ifelse(nplacedata$MODE==26,"Metro",ifelse(nplacedata$MODE==27,"Street Car/Cable Car",ifelse(nplacedata$MODE==28,"Other Rail",ifelse(nplacedata$MODE==29,"Ferry / Boat","Don't Know/Refused")))))))))))))))))))))))))))))
```


Now, we first focus on trips ending in Del Norte County.  Here we use different 
weights depending on the origin of the trip.  Specifically, when the origin is Del Norte 
County, we use the county-specific weights.  When the origin is outside 
Del Norte County, we use the statewide weights.

```{r dnc-3,cache=TRUE}
# Trips to Del Norte County
# Create a subset for trips to Del Norte county 
# We are only interested in trips to Del Norte County (CTFIP=15) 
# Create a subset for trips to Del Norte County 
place_15<-subset(nplacedata,CTFIP==15)
names(place_15)
# Change the weight for non Del Norte County origin (Assign state wide weight for non Del Norte origin)
place_15$NTCFW <- ifelse((place_15$OCTFIP==15), place_15$NEXPTCFPERWGT, place_15$EXPTCFPERWGT)
head(place_15)
```

So `place_15$NTCFW` now contains the trips ending in Del Norte county with appropriate 
expansion weights appended.  Now we can generate observations for modal split for trips 
to Del Norte based on these weights.

Notes: In the tables: Ob = Observations, Per = Percent, UW = Unweighted and W = Weighted.

```{r dnc-4,cache=TRUE}
## Generate frequency for trip Mode
temp1<-as.data.frame(table(place_15$Mode))
## Create percentage of frequency
temp1$Percent<-temp1$Freq*100/sum(temp1$Freq)
## Names 
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","Ob_UW","Per_UW")
## Show the results
temp1
```

Now we compute the weighted frequency.

```{r dnc-5,cache=TRUE}
## Create weighted frequency
temp2<-aggregate(NTCFW~Mode,FUN=sum,data=place_15)
## Create weighted percentage
temp2$Percent<-temp2$NTCFW*100/sum(temp2$NTCFW)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","Ob_W","Per_W")
## Show
temp2
```

Now we can save these results in a `csv` file for later use.

```{r dnc-6,cache=TRUE}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE,sort=TRUE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
Mode_15d<-temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:5],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="Mode_15d.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
```

#### Trip duration by mode

Next, we perform a similar computation for Total Trip duration for all trips ending 
in Del Norte, by mode.

```{r dnc-7,cache=TRUE}
## Generate frequency for trip Mode
temp1<-aggregate(TRIPDUR~Mode,FUN=sum,data=place_15)
## Create  percentage
temp1$Percent<-temp1$TRIPDUR*100/sum(temp1$TRIPDUR)
## Names
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","TDu_UW","Per_UW")
## Show
temp1
```

Again, we compute the weighted frequency.

```{r dnc-8,cache=TRUE}
## Create weighted frequency
temp<-place_15$NTCFW*place_15$TRIPDUR
temp2<-aggregate(temp~Mode,FUN=sum,data=place_15)
## Create weighted percentage
temp2$Percent<-temp2$temp*100/sum(temp2$temp)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","TDu_W","Per_W")
## Show
temp2
```


And as before, we save the results for later use. 

```{r dnc-9,cache=TRUE}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE)
temp3 <- temp3[,c(1,2,4,3,5)]
# Average trip duration
temp3$avg_uw<-temp3$TDu_UW/Mode_15d$Ob_UW
temp3
temp3$avg_w<-temp3$TDu_W/Mode_15d$Ob_W
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:7],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="TripDUrm_D15.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
rm(temp)
```

#### Trip distance by mode

Moving on, we determine Total Trip distance for all trips ending in Del Norte, by mode.

```{r dnc-10,cache=TRUE}
## Generate frequency for trip Mode
temp1<-aggregate(TripDistance~Mode,FUN=sum,data=place_15)
## Create  percentage
temp1$Percent<-temp1$TripDistance*100/sum(temp1$TripDistance)
## Names
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","TDis_UW","Per_UW")
## Show
temp1
```

Next, we compute the weighted trip distance by mode.

```{r dnc-11,cache=TRUE}
## Create weighted frequency
temp<-place_15$NTCFW*place_15$TripDistance
temp2<-aggregate(temp~Mode,FUN=sum,data=place_15)
## Create weighted percentage
temp2$Percent<-temp2$temp*100/sum(temp2$temp)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","TDis_W","Per_W")
## Show
temp2
```

And, we save the results for later use.

```{r dnc-12,cache=TRUE}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE)
temp3 <- temp3[,c(1,2,4,3,5)]
# Average trip distance
temp3$avg_uw<-temp3$TDis_UW/Mode_15d$Ob_UW
temp3
temp3$avg_w<-temp3$TDis_W/Mode_15d$Ob_W
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:7],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="TripDistanceM_D15.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
rm(temp)
```

#### Modal split for driving alone

The next question was the modal split for Drive Alone.  To compute this, we
subset the data based on `TOTTR` (Total travelers) and `MODE={5, 6, 7, 8, 10}` 
(basically, the driver of a car, truck, or motorcycle)

```{r dnc-13}
place_15d<-subset(place_15,(TOTTR==1 & (MODE==5|MODE==6|MODE==7|MODE==8|MODE==10)))
head(place_15d)
```

Now we compute the frequency of modes for this subset.

```{r dnc-14}
## Create frequency for different Mode category for drive alone
temp1<-as.data.frame(table(place_15d$Mode))
## Create percentage of frequency
temp1$Percent<-temp1$Freq*100/sum(temp1$Freq)
## Names 
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","Ob_UW","Per_UW")
## Show the results
temp1
```

Following the pattern, we compute the weighted frequency.

```{r dnc-15}
## Create weighted frequency
temp2<-aggregate(NTCFW~Mode,FUN=sum,data=place_15d)
## Create weighted percentage
temp2$Percent<-temp2$NTCFW*100/sum(temp2$NTCFW)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","Ob_W","Per_W")
## Show
temp2
```

Then, once again, we save the results for later use.

```{r dnc-16}

## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE,sort=FALSE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:5],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="Mode_15Ddrialn.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
```


### Trips from Del Norte County

Now we perform a similar computation for trips *from* Del Norte County.  As before, we
subset the place data, but this time for trips originating in Del Norte County.

```{r dnc-17,cache=TRUE}

# Let us estimate trips from Del Norte county (OCTFIP=15) 
# Create a subset for trips from Del Norte county 
place_15O<-subset(nplacedata,OCTFIP==15)
names(place_15O)
head(place_15O)
```

#### Trips by mode

Now we generate the mode frequency table for all trips from Del Norte County.

```{r dnc-18,cache=TRUE}
# Generate observations for modal split for trips from Del Norte based on new weights
## Generate frequency for trip Mode
temp1<-as.data.frame(table(place_15O$Mode))
## Create percentage of frequency
temp1$Percent<-temp1$Freq*100/sum(temp1$Freq)
## Names 
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","Ob_UW","Per_UW")
## Show the results
temp1
```

This should be looking familiar now.  Here is the weighted frequency.

```{r dnc-19,cache=TRUE}
## Create weighted frequency
temp2<-aggregate(NEXPTCFPERWGT~Mode,FUN=sum,data=place_15O)
## Create weighted percentage
temp2$Percent<-temp2$NEXPTCFPERWGT*100/sum(temp2$NEXPTCFPERWGT)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","Ob_W","Per_W")
## Show
temp2
```

And again, we save for later use.

```{r dnc-20,cache=TRUE}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE,sort=FALSE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
Mode_15O<-temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:5],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="Mode_15O.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
```

#### Trip duration by Mode

Now we repeat the trip duration calculation for Del Norte Origins.

```{r dnc-21,cache=TRUE}
## Total Trip duration for all trips from Del Norte, by Mode
## Generate frequency for trip Mode
temp1<-aggregate(TRIPDUR~Mode,FUN=sum,data=place_15O)
## Create  percentage
temp1$Percent<-temp1$TRIPDUR*100/sum(temp1$TRIPDUR)
## Names
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","TDu_UW","Per_UW")
## Show
temp1
```

Here is the weighted frequency calculation.

```{r dnc-22,cache=TRUE}
## Create weighted frequency
temp<-place_15O$NEXPTCFPERWGT*place_15O$TRIPDUR
temp2<-aggregate(temp~Mode,FUN=sum,data=place_15O)
## Create weighted percentage
temp2$Percent<-temp2$temp*100/sum(temp2$temp)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","TDu_W","Per_W")
## Show
temp2
```

And we save again.

```{r dnc-23,cache=TRUE}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
temp3$avg_uw<-temp3$TDu_UW/Mode_15O$Ob_UW
temp3
temp3$avg_w<-temp3$TDu_W/Mode_15O$Ob_W
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:7],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="TripDUrm_O.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
rm(temp)
```

#### Trip distance by Mode

Here is the trip distance calculation for all trips from Del Norte, by Mode.

```{r dnc-24,cache=TRUE}
## Generate frequency for trip Mode
temp1<-aggregate(TripDistance~Mode,FUN=sum,data=place_15O)
## Create  percentage
temp1$Percent<-temp1$TripDistance*100/sum(temp1$TripDistance)
## Names
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","TDis_UW","Per_UW")
## Show
temp1
```

Followed again by the weighted frequency calculation.

```{r dnc-25,cache=TRUE}
## Create weighted frequency
temp<-place_15O$NEXPTCFPERWGT*place_15O$TripDistance
temp2<-aggregate(temp~Mode,FUN=sum,data=place_15O)
## Create weighted percentage
temp2$Percent<-temp2$temp*100/sum(temp2$temp)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","TDis_W","Per_W")
## Show
temp2
```

And our now familiar save of the data.

```{r dnc-26,cache=TRUE}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
temp3$avg_uw<-temp3$TDis_UW/Mode_15O$Ob_UW
temp3
temp3$avg_w<-temp3$TDis_W/Mode_15O$Ob_W
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:7],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="TripDistanceM_O.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
rm(temp)
```

#### Modal split for driving alone

And lastly for the Del Norte origins, here is the drive alone modal split.  As before, 
we subset the data based on `TOTTR` (Total travelers) and `MODE={5, 6, 7, 8, 10}`
(the driver of a car, truck, or motorcycle) 

```{r dnc-27,cache=TRUE} 
place_15dO<-subset(place_15O,(TOTTR==1 & (MODE==5|MODE==6|MODE==7|MODE==8|MODE==10)))
head(place_15dO)
```

The raw frequency table is here.

```{r dnc-28,cache=TRUE}
## Create frequency for different mode category for drive alone
temp1<-as.data.frame(table(place_15dO$Mode))
## Create percentage of frequency
temp1$Percent<-temp1$Freq*100/sum(temp1$Freq)
## Names 
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","Observations_UW","Percent_UW")
## Show the results
temp1
```

This is followed by the weighted frequency table.

```{r dnc-29,cache=TRUE}
## Create weighted frequency
temp2<-aggregate(NEXPTCFPERWGT~Mode,FUN=sum,data=place_15dO)
## Create weighted percentage
temp2$Percent<-temp2$NEXPTCFPERWGT*100/sum(temp2$NEXPTCFPERWGT)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","Observations_W","Percent_W")
## Show
temp2
```

And here we again save the results.

```{r dnc-30,cache=TRUE}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE,sort=FALSE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:5],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="Mode_15Odrialn.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
```

### Trip Purpose Calculations

Now we need trip purpose breakdown, so we need to import activity level data with the 
appropriate weights.  Here we load and merge them.

```{r dnc-31,cache=TRUE}
#Import the activity level variables csv file and give a new name
#act_data <- read.csv("c:/Users/user/Documents/Suman_research/Caltrans Project/Data/deliv_activity.csv", header=TRUE)
library(chts2011)
act_data <- chts_act
names(act_data)

# Merge the person weight file with place level data file
act_place<-merge(act_data,nplacedata, by =c("SAMPN","PERNO","PLANO"), all = FALSE)
names(act_place)
```

For display purposes, we convert the purpose codes into readable strings.

```{r dnc-32, cache=TRUE}
act_place$Actpur<-ifelse(
  act_place$APURP==1," Personal Activities",
  ifelse
  (act_place$APURP==2," Preparing Meals/Eating",
   ifelse
   (act_place$APURP==3," Hosting Visitors/Entertaining Guests",
    ifelse
    (act_place$APURP==4," Exercise ",
     ifelse
     (act_place$APURP==5," Study/Schoolwork ",
      ifelse
      (act_place$APURP==6," Work For Pay At Home Using ",
       ifelse
       (act_place$APURP==7," Using Computer/Telephone/Cell Or Smart Phone",
        ifelse
        (act_place$APURP==8," All Other Activities At My Home ",
         ifelse
         (act_place$APURP==9," Work/Job Duties ",
          ifelse
          (act_place$APURP==10," Training",
           ifelse
           (act_place$APURP==11," Meals At Work ",
            ifelse
            (act_place$APURP==12," Work-Sponsored Social Activities ",
                                                                                                                                                      ifelse
             (act_place$APURP==13," Non-Work Related Activities",
              ifelse
              (act_place$APURP==14," Exercise/Sports ",
               ifelse
               (act_place$APURP==15," Volunteer Work/Activities",
                ifelse
                (act_place$APURP==16," All Other Work-Related Activities At My Work ",
                 ifelse
                 (act_place$APURP==17," In School/Classroom/Laboratory ",
                  ifelse
                  (act_place$APURP==18," Meals At School/College ",
                   ifelse
                   (act_place$APURP==19," After School Sports/Physical Activity ",
                    ifelse
                    (act_place$APURP==20," All Other After School Related Activities ",
                     ifelse
                     (act_place$APURP==21," Change Type Of Transportation/Transfer ", 
                      ifelse
                      (act_place$APURP==22," Pickup/Drop Off Passenger(S)", 
                       ifelse
                       (act_place$APURP==23," Drive Through Meals ", 
                        ifelse
                        (act_place$APURP==24," Drive Through Other (ATM, Bank) ",
                         ifelse
                         (act_place$APURP==25," Work-Related",
                          ifelse
                          (act_place$APURP==26," Service Private Vehicle",
                           ifelse
                           (act_place$APURP==27," Routine Shopping ",
                            ifelse
                            (act_place$APURP==28," Shopping For Major Purchases",
                             ifelse
                             (act_place$APURP==29," Household Errands", 
                              ifelse
                              (act_place$APURP==30," Personal Business ", 
                               ifelse
                               (act_place$APURP==31," Eat Meal at Restaurant/Diner", 
                                ifelse
                                (act_place$APURP==32," Health Care", 
                                 ifelse
                                 (act_place$APURP==33," Civic/Religious Activities", 
                                  ifelse
                                  (act_place$APURP==34," Outdoor Exercise", 
                                   ifelse
                                   (act_place$APURP==35," Indoor Exercise", 
                                    ifelse
                                    (act_place$APURP==36," Entertainment ", 
                                     ifelse
                                     (act_place$APURP==37," Social/Visit Friends/Relatives", 
                                      ifelse
                                      (act_place$APURP==38," Other ", 
                                       ifelse
                                       (act_place$APURP==39," Loop Trip", 
                                        " Don't Know/Refused")))))))))))))))))))))))))))))))))))))))
head(act_place)
```

#### Trip Purposes from Del Norte County

We start with trips from Del Norte County, subsetting based open the origin county `OCTFIP=15`.

```{r dnc-33, cache=TRUE}
# Now we are interested in trips from Del Norte county (OCTFIP=15) 
# Create a subset for trips from Del Norte County 
act_15O<-subset(act_place,OCTFIP==15)
names(act_15O)
head(act_15O)
```

Next, we compute the observations for trip purpose for trips from Del Norte based on new weights.

```{r dnc-34,cache=TRUE}
## Generate frequency for trip Mode
temp1<-as.data.frame(table(act_15O$Actpur))
## Create percentage of frequency
temp1$Percent<-temp1$Freq*100/sum(temp1$Freq)
## Names 
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Actpur","Ob_UW","Per_UW")
## Show the results
temp1
```

This is followed by the weighted trip purpose frequencies.

```{r dnc-35,cache=TRUE}
## Create weighted frequency
temp2<-aggregate(NEXPTCFPERWGT~Actpur,FUN=sum,data=act_15O)
## Create weighted percentage
temp2$Percent<-temp2$NEXPTCFPERWGT*100/sum(temp2$NEXPTCFPERWGT)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Actpur","Ob_W","Per_W")
## Show
temp2
```

And here we save the results.

```{r dnc-36}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Actpur", all = TRUE,sort=FALSE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:5],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="Actpur_15O.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
```


### Work Trips by Mode

The last sub question wanted work trips by Mode for Del Norte County.  


#### Work Trips Originating in Del Norte County

First, we reuse the merged activity table from above for trips activities (and associated trips) originating in Del Norte 
County, and subset it for work trips only.

```{r dnc-37}
# Create a subset for work trips
actw_15O<-subset(act_15O,APURP==9)
```

Now, we can determine the observations of each Mode used for work trips.

```{r dnc-38,cache=TRUE}
## Generate frequency for trip Mode
temp1<-as.data.frame(table(actw_15O$Mode))
## Create percentage of frequency
temp1$Percent<-temp1$Freq*100/sum(temp1$Freq)
## Names 
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","Ob_UW","Per_UW")
## Show the results
temp1
```

Given those, we can expand them with the weights for Del Norte.

```{r dnc-39,cache=TRUE}
## Create weighted frequency
temp2<-aggregate(NEXPTCFPERWGT~Mode,FUN=sum,data=actw_15O)
## Create weighted percentage
temp2$Percent<-temp2$NEXPTCFPERWGT*100/sum(temp2$NEXPTCFPERWGT)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","Ob_W","Per_W")
## Show
temp2
```

And again, we finish by saving the results.

```{r dnc-40,cache=TRUE}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE,sort=FALSE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:5],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="Mode_wact15O.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
```

#### Work Trips Ending in Del Norte County

Now we want to find trips ending in Del Norte county `(CTFIP=15)`.  Again, we subset
the place table and adjust the weights to be Del Norte weights if the origins are in
Del Norte, and to use statewide weights if the origins are outside Del Norte.


```{r dnc-41,cache=TRUE}
# Create a subset for trips from Del Norte County 
act_15D<-subset(act_place,CTFIP==15)
names(act_15D)
head(act_15D)
# Change the weight for non Del Norte county origin (Assign state wide weight for non Del Norte origin)
act_15D$NTCFW <- ifelse((act_15D$OCTFIP==15), act_15D$NEXPTCFPERWGT, act_15D$EXPTCFPERWGT.y)
names(act_15D)
head(act_15D)
```

Again, we generate a frequency table by purpose.

```{r dnc-42,cache=TRUE}
# Generate observations by trip purpose from Del Norte based on new weights
## Generate frequency for trip Mode
temp1<-as.data.frame(table(act_15D$Actpur))
## Create percentage of frequency
temp1$Percent<-temp1$Freq*100/sum(temp1$Freq)
## Names 
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Actpur","Ob_UW","Per_UW")
## Show the results
temp1
```

We follow this with the weighted frequency table.

```{r dnc-43,cache=TRUE}
## Create weighted frequency
temp2<-aggregate(NTCFW~Actpur,FUN=sum,data=act_15D)
## Create weighted percentage
temp2$Percent<-temp2$NTCFW*100/sum(temp2$NTCFW)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Actpur","Ob_W","Per_W")
## Show
temp2
```

And again we save the result.

```{r dnc-44,cache=TRUE}
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Actpur", all = TRUE,sort=FALSE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:5],na.rm = TRUE)))
temp3
## Save as csv file
write.csv(temp3,file="Actpur_15D.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
```

Finally, we compute the frequencies of various Modes used for work trips ending
in Del Norte County.

```{r dnc-45,cache=TRUE}
# We want only work trips (APURP=9)
# Create a subset for work trips
actw_15D<-subset(act_15D,APURP==9)
## Generate frequency for trip Mode
temp1<-as.data.frame(table(actw_15D$Mode))
## Create percentage of frequency
temp1$Percent<-temp1$Freq*100/sum(temp1$Freq)
## Names 
names(temp1)
## Rename the variables
colnames(temp1)[c(1:3)] <- c("Mode","Ob_UW","Per_UW")
## Show the results
temp1
```

Here is the weighted frequency table.

```{r dnc-46,cache=TRUE}
## Create weighted frequency
temp2<-aggregate(NTCFW~Mode,FUN=sum,data=actw_15D)
## Create weighted percentage
temp2$Percent<-temp2$NTCFW*100/sum(temp2$NTCFW)
## Names
names(temp2)
## Rename the variables
colnames(temp2)[c(1:3)] <- c("Mode","Ob_W","Per_W")
## Show
temp2
## Merge the two files and save
temp3<-merge(temp1,temp2, by ="Mode", all = TRUE,sort=FALSE)
temp3 <- temp3[,c(1,2,4,3,5)]
temp3
temp3[,1]<-as.character(temp3[,1])
temp3<- rbind(temp3, c("Total", colSums(temp3[,2:5],na.rm = TRUE)))
temp3
```

...and one last time we save it.

```{r dnc-47,cache=TRUE}
## Save as csv file
write.csv(temp3,file="Mode_wact15D.csv",row.names=FALSE)
rm(temp1)
rm(temp2)
rm(temp3)
```

